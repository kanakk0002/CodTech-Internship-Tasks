<full Python code with comments, inserted here after this step>